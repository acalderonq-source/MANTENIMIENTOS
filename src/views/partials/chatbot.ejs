<!-- FAB (botón flotante) -->
<button id="ia-fab" aria-label="Asistente IA">
  🤖
</button>

<!-- Panel del asistente -->
<aside id="ia-panel" class="card">
  <div class="ia-header">
    <strong>Asistente IA</strong>
    <small class="muted">Consulta por placa o pide próximos</small>
  </div>

  <div class="ia-body" id="ia-messages">
    <div class="msg bot">
      Hola 👋 Soy tu asistente. Escribe una placa (p. ej. C167062) para ver el próximo mantenimiento, o escribe “próximos” para ver sugerencias.
    </div>
  </div>

  <form id="ia-form">
    <input id="ia-input" type="text" placeholder="Escribe tu pregunta..." autocomplete="off" />
    <button class="btn" type="submit">Enviar</button>
  </form>
</aside>

<script>
  const $form = document.querySelector('#ia-form');
  const $input = document.querySelector('#ia-input');
  const $msgs = document.querySelector('#ia-messages');

  function addMsg(text, from='bot') {
    const div = document.createElement('div');
    div.className = 'msg ' + from;
    div.textContent = text;
    $msgs.appendChild(div);
    $msgs.scrollTop = $msgs.scrollHeight;
  }

  $form?.addEventListener('submit', async (e) => {
    e.preventDefault();
    const txt = ($input.value || '').trim();
    if (!txt) return;
    addMsg(txt, 'me');
    $input.value = '';
    try {
      const r = await fetch('/ai/chat', {
        method: 'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify({ message: txt })
      });
      const data = await r.json();
      addMsg(data.reply || 'No tengo respuesta.', 'bot');
    } catch (err) {
      addMsg('No pude responder ahora.', 'bot');
    }
  });
</script>
