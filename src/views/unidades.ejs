<section class="card">
  <h1>Unidades</h1>

  <!-- Filtro por cede -->
  <form method="get" action="/unidades" class="row gap">
    <label>Cede:
      <select name="cedis_id" onchange="this.form.submit()">
        <option value="">â€” Todas â€”</option>
        <% (cedis||[]).forEach(c => { %>
          <option value="<%= c.id %>" <%= String(cedisId||'')===String(c.id)?'selected':'' %>><%= c.nombre %></option>
        <% }) %>
      </select>
    </label>
  </form>

  <table class="table">
    <thead>
      <tr><th>Placa</th><th>Cede</th><th>Tipo</th><th>Kilometraje</th><th>Estado</th><th>Acciones</th></tr>
    </thead>
    <tbody>
      <% (unidades||[]).forEach(u => { %>
        <tr>
          <td><a href="/historial/<%= u.placa %>"><%= u.placa %></a></td>
          <td><%= u.cedis_nombre || 'â€”' %></td>
          <td><%= u.tipo || 'â€”' %></td>
          <td><%= u.kilometraje ?? 'â€”' %></td>
          <td><%= u.estado || 'â€”' %></td>
          <td>
            <form method="post" action="/unidades/<%= u.id %>/programar<%= cedisId ? ('?cedis_id='+cedisId) : '' %>">
              <button class="btn primary">ðŸ“… Programar</button>
            </form>
          </td>
        </tr>
      <% }) %>
    </tbody>
  </table>

  <!-- Programar cede completa -->
  <form method="post" action="/unidades/programar-cede" class="row gap" style="margin-top:8px;">
    <label>Programar cede completa:
      <select name="cedis_id" required>
        <option value="">â€” Seleccionar cede â€”</option>
        <% (cedis||[]).forEach(c => { %>
          <option value="<%= c.id %>"><%= c.nombre %></option>
        <% }) %>
      </select>
    </label>
    <button class="btn primary">Programar</button>
  </form>
</section>
